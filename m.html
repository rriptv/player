<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic JW Player</title>
    
    <script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>

    <style>
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; }
        #player { width: 100%; height: 100vh; }
    </style>
</head>
<body>

<div id="player"></div>

<script>
    function getParameterByName(name) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(window.location.href);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    // 1. Get the full 'id' parameter from the URL
    var rawInput = getParameterByName('id');

    if (rawInput) {
        // 2. Split the string at the custom separator "?|"
        // Part 0 = Stream URL, Part 1 = DRM Info
        var parts = rawInput.split('?|');
        var streamUrl = parts[0];
        var drmInfo = parts[1];

        // 3. Extract the Key ID and Key
        // Logic: Find the string after "drmLicense="
        var keyString = "";
        if (drmInfo && drmInfo.includes("drmLicense=")) {
            // Split by "drmLicense=" and take the second part
            var temp = drmInfo.split("drmLicense=")[1];
            // If there are other parameters after, split by "&" (just in case)
            keyString = temp.split("&")[0]; 
        }

        // 4. Split Key ID and Key (Format: KID:KEY)
        var keyParts = keyString.split(":");
        var keyId = keyParts[0];
        var key = keyParts[1];

        // 5. Construct the ClearKey Object dynamically
        var clearKeyObj = {};
        clearKeyObj["keyId"] = "key"; // Standard requirement
        clearKeyObj[keyId] = key;     // The dynamic key pair

        // 6. Setup JW Player
        jwplayer("player").setup({
            playlist: [{
                file: streamUrl,
                type: "dash",
                drm: {
                    clearkey: clearKeyObj
                }
            }],
            width: "100%",
            height: "100%",
            autostart: true,
            mute: false,
            stretching: "exactfit"
        });

    } else {
        document.body.innerHTML = '<h2 style="color:white; text-align:center; margin-top:20%;">No ID Parameter Found</h2>';
    }
</script>

</body>
</html>
