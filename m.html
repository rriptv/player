<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal JW Player</title>
    
    <script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>

    <style>
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; }
        #player { width: 100%; height: 100vh; }
    </style>
</head>
<body>

<div id="player"></div>

<script>
    // 1. Helper to get URL parameters
    function getQueryParam(name) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    var rawInput = getQueryParam('id');
    var streamUrl = "";
    var keyId = "";
    var key = "";

    if (rawInput) {
        // --- LOGIC TO DETECT FORMAT ---

        // FORMAT 2: contains "?|drmScheme=" (The long one)
        if (rawInput.includes("?|drmScheme=")) {
            var parts = rawInput.split("?|");
            streamUrl = parts[0];
            
            // Extract keys from drmLicense parameter
            var paramsPart = parts[1]; // e.g., drmScheme=clearkey&drmLicense=kid:key
            if (paramsPart.includes("drmLicense=")) {
                var temp = paramsPart.split("drmLicense=")[1];
                // Clean up if there are more parameters after (&)
                var keyString = temp.split("&")[0]; 
                var keyParts = keyString.split(":");
                if (keyParts.length === 2) {
                    keyId = keyParts[0];
                    key = keyParts[1];
                }
            }
        } 
        // FORMAT 1: contains just "|" (The short one)
        else if (rawInput.includes("|")) {
            var parts = rawInput.split("|");
            streamUrl = parts[0];
            var keyString = parts[1]; // e.g., kid:key
            
            var keyParts = keyString.split(":");
            if (keyParts.length === 2) {
                keyId = keyParts[0];
                key = keyParts[1];
            }
        }
        // FALLBACK: Just a URL (No keys)
        else {
            streamUrl = rawInput;
        }

        // --- SETUP JW PLAYER ---
        
        // Define the playlist object
        var playlistItem = {
            file: streamUrl,
            type: "dash",
            // Only add DRM block if keys were found
            drm: (keyId && key) ? {
                clearkey: {
                    "keyId": keyId,
                    "key": key
                }
            } : undefined
        };

        jwplayer("player").setup({
            // IMPORTANT: If you have a license key, uncomment the line below:
            // key: "YOUR_LICENSE_KEY_HERE", 
            playlist: [playlistItem],
            width: "100%",
            height: "100%",
            autostart: true,
            mute: false,
            stretching: "exactfit",
            cast: {}
        });

    } else {
        document.body.innerHTML = '<h2 style="color:white;text-align:center;margin-top:20%">No Video ID Found</h2>';
    }
</script>

</body>
</html>
