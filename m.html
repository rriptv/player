<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clappr Player</title>
    <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dash-shaka-playback@latest/dist/dash-shaka-playback.min.js"></script>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; }
        #player { width: 100%; height: 100vh; }
    </style>
</head>
<body>

<div id="player"></div>

<script>
    // 1. Get URL Parameter
    function getParam(name) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(window.location.href);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    var rawInput = getParam('id');

    if (rawInput) {
        // 2. Parse the Link (Split URL and Keys)
        var parts = rawInput.split('?|');
        var streamUrl = parts[0];
        var drmInfo = parts[1] || "";

        // 3. Extract Key ID and Key
        var keyId = "";
        var key = "";

        if (drmInfo.includes("drmLicense=")) {
            var temp = drmInfo.split("drmLicense=")[1];
            var keyString = temp.split("&")[0]; // Clean up extra params
            var keyParts = keyString.split(":");
            if (keyParts.length === 2) {
                keyId = keyParts[0];
                key = keyParts[1];
            }
        }

        // 4. Configure Clappr with Shaka (ClearKey)
        var player = new Clappr.Player({
            source: streamUrl,
            parentId: "#player",
            plugins: [DashShakaPlayback], // Load Shaka plugin for DASH
            width: '100%',
            height: '100%',
            autoPlay: true,
            shakaConfiguration: {
                drm: {
                    clearKeys: {
                        [keyId]: key 
                    }
                },
                preferredAudioLanguage: 'en-US',
            }
        });

    } else {
        document.body.innerHTML = '<h3 style="color:white;text-align:center;margin-top:20%">No ID Parameter Found</h3>';
    }
</script>

</body>
</html>
