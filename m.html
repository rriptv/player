<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JW Player Auto-Parse</title>
    
    <script type="text/javascript" src="https://fle-rvd0i9o8-moo.com/player/jw8_26/jwplayer.js?v=5.0.2"></script>
    
    <script>
        // 2. Your License Key
        jwplayer.key = 'eNFaXCjyURVoCCGiHp7HTQ3hDhE/AfL0g8VE1fRbL84=';
    </script>

    <style>
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; }
        #player { width: 100%; height: 100vh; }
    </style>
</head>
<body>

<div id="player"></div>

<script>
    // 3. Robust URL Extraction
    var currentUrl = window.location.href;
    var rawInput = "";
    
    // Grab everything after "id="
    if (currentUrl.indexOf("id=") > -1) {
        rawInput = currentUrl.substring(currentUrl.indexOf("id=") + 3);
    }

    var streamUrl = "";
    var keyId = "";
    var key = "";

    if (rawInput) {
        
        // --- PARSING LOGIC START ---

        // Check if the link contains the "drmLicense" parameter explicitly
        if (rawInput.includes("drmLicense=")) {
            
            // Split by "drmLicense=" to get the key part
            var splitParts = rawInput.split("drmLicense=");
            var keyPart = splitParts[1]; 
            
            // Clean up: stop at the next "&" if it exists, or take the whole string
            var fullKeyString = keyPart.split("&")[0];
            
            // Extract the MPD link (Everything before the separator)
            // We check for "|drmScheme" or "?|drmScheme" or just "|"
            if (rawInput.includes("|drmScheme=")) {
                streamUrl = rawInput.split("|drmScheme=")[0];
            } else if (rawInput.includes("?|drmScheme=")) {
                streamUrl = rawInput.split("?|drmScheme=")[0];
            } else {
                // Fallback: split by the first pipe if standard separators aren't found
                streamUrl = splitParts[0]; 
                // Clean up the trailing characters from the URL part (like "|drmScheme=" or just "|")
                if(streamUrl.endsWith("|drmScheme=") || streamUrl.endsWith("?|drmScheme=")) {
                   // This is handled above, but just in case
                } else {
                   // Remove any pipe at the end of the URL if it stuck
                   streamUrl = streamUrl.split("|")[0];
                }
            }

            // Parse the Key ID and Key
            var keyParts = fullKeyString.split(":");
            if (keyParts.length === 2) {
                keyId = keyParts[0];
                key = keyParts[1];
            }

        } 
        // Standard Format: Link|KeyID:Key (No drmScheme text)
        else if (rawInput.includes("|")) {
            var parts = rawInput.split("|");
            var lastPart = parts.pop(); // Assume last part is key
            streamUrl = parts.join("|");
            
            var keyParts = lastPart.split(":");
            if (keyParts.length === 2) {
                keyId = keyParts[0];
                key = keyParts[1];
            }
        } 
        // No Key found
        else {
            streamUrl = rawInput;
        }

        // --- PARSING LOGIC END ---

        // Debugging (Optional: check console to see if it worked)
        console.log("Stream:", streamUrl);
        console.log("Key:", keyId, key);

        // 4. DRM Configuration
        var drmConfig = undefined;
        if (keyId && key) {
            var clearkeyObj = {};
            clearkeyObj[keyId] = key;
            drmConfig = {
                clearkey: clearkeyObj
            };
        }

        // 5. Setup Player
        jwplayer("player").setup({
            playlist: [{
                file: streamUrl,
                type: "dash",
                drm: drmConfig
            }],
            width: "100%",
            height: "100%",
            autostart: true,
            mute: false,
            stretching: "exactfit"
        });

    } else {
        document.body.innerHTML = '<h3 style="color:white; text-align:center; margin-top:20%">No ID Parameter Found</h3>';
    }
</script>

</body>
</html>
